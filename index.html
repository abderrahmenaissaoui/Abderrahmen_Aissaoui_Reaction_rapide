<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RÃ©action rapide</title>
  </head>
  <style>
    body {
      text-align: center;
      background-color: #e5e5e5;
      font-family: "Inter", sans-serif;
      margin: 0;
    }
    #test-container {
      background-color: #0077b6;
      width: auto;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      margin: 0;
      gap: 1.2em;
      color: whitesmoke;
      padding: 2em 2em;
      font-size: 2em;
      margin-bottom: 1em;
      min-height: 625px;
    }
    #start {
      border-radius: 0.5em;
      background: linear-gradient(90deg, #c9f1ff, #8ed8f8);
      color: #003b5c;
      padding: 1em 2em;
      border: none;
      margin-top: 1em;
      font-size: 1em;
    }
    .info {
      width: 100%;
      margin: 0 auto;
      font-size: 1.1em;
    }
    .info > div {
      background-color: white;
      padding-top: 0.5em;
      padding-left: 2em;
      padding-right: 2em;
      border-radius: 1em;
      min-height: 350px;
      min-width: 300px;
      width: 30%;
    }

    #stats {
      display: flex;
      flex-direction: row;
      justify-content: center;
      width:90%;
      gap: 5em;
    }
    #personal-score {
      background-color: #e5e5e5;
      width: 100%;
      height: 200px;
      min-height: 20px;
      overflow: visible;
      border-radius: 1em;
    }
    #niveaux {
      padding-left: 2.5em;
      display: flex;
      align-items: center;
    }
    .emojie{
      padding-left: 2em;
      font-size: 2em;
    }
    .flash {
      margin-bottom: 0.5em;
      display: inline-block;
      font-size: 2em;
    }

    #settings {
      background-color: white;
      padding-top: 0.5em;
      border-radius: 1em;
      width: 68%;
      margin: 2em auto;
      min-height: 300px;
      font-size: 1.2em;
      padding-bottom: 0.5em;
    }
    #settings > button {
      margin: 1em auto;
      border: none;
      border-radius: 0.5em;
      background: linear-gradient(90deg, #c9f1ff, #8ed8f8);
      font-size: 1em;
      padding: 0.8em 1.6em;
    }
    #settings > button.active-mode {
      background: linear-gradient(90deg, #04b926, #038a1e);
      color: white;
      font-size: 1.3em;
      padding: 1em 2em;
      font-weight: bold;
      box-shadow: 0 6px 20px rgba(4, 185, 38, 0.4);
    }
    button {
      cursor: pointer;
      transition: 0.25s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.253);
    }


    @media (max-width: 768px){
         #test-container {
            word-wrap: break-word;
            overflow-wrap: break-word;
            text-align: center;
            gap: 1.2em;
            color: whitesmoke;
            padding: 2em 2em;
            font-size: 1.5em;
            margin-bottom: 1em;
            width: auto;
        }
        #stats{
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
         #stats > div { 
          width: 70%;
          min-width: auto;
        }

        #personal-score{
          font-size: 0.95em;
          padding-top:0em;
          padding-bottom: 1em;
        }

        #settings {
            width: 90%;
        }
        #start {
            border-radius: 0.5em;
            background: linear-gradient(90deg, #c9f1ff, #8ed8f8);
            color: #003b5c;
            padding: 0.5em 1em;
            border: none;
            margin-top: 0.5em;
            font-size: 0.8em;
        }
        .info > div {
            min-width: auto; 
        }
        #settings > button.active-mode{
          font-size: 1em;
        }
       #niveaux {
        padding-left:2.8em;
        padding-right:2.8em;
        font-size: 0.758em;
        margin-bottom: 4em;
      }
    }
  </style>
  <body>
    <!-- conteur du test. -->
    <div id="test-container">
      <div class="instruction">
        <h1>
          <span class="flash">âš¡</span> <br />
          Temps De RÃ©action Test
        </h1>
        <!-- Instructions -->
        <span>Lorsque la boÃ®te </span>
        <span style="color: #f00; font-size: 1.5em">â– </span>
        <span>Rouge devient </span>
        <span style="color: #04b962; font-size: 1.5em">â– </span>
        <span>Verte, cliquez aussi vite que possible<br /></span>
      </div>
      <!-- start button  -->
      <button id="start">CLIQUEZ POUR COMMENCER</button>
    </div>
    <!-- score personnel -->
    <div class="info" id="stats">
      <div id="score">
        <h3>Meilleure performance ğŸ†</h3>
        <h5>Votre meilleur temps</h5>
        <div id="personal-score"></div>
      </div>
      <!-- les niveaux par rapport au score -->
      <div id="niveaux">
        <p>
          âŒ DÃ©butant: 400 ms et plus <span class="emojie">ğŸ¢</span><br /><br />

          âŒ IntermÃ©diaire: 300-399ms<span class="emojie">ğŸ¯</span><br /><br />

          âŒ AvancÃ©: 200-299ms<span class="emojie">ğŸš€</span><br /><br />

          âŒ Professionnel: 150-199ms<span class="emojie">ğŸ†</span><br /><br />

          âŒ Ã‰lite: 0-149ms<span class="emojie">ğŸ‘‘</span><br /><br />
        </p>
      </div>
    </div>
    <!-- paramÃ¨tres d'entrÃ©e -->
    <div class="info" id="settings">
      <h3>ParamÃ¨tres âš™ï¸</h3>
      <h5>MÃ©thode d'entrÃ©e</h5>
      <button id="souris">Clic de souris</button><br />
      <button id="espace">Appui sur la barre d'espace</button>
    </div>
    <script>
        // ====================================
        // INITIALISATION DES VARIABLES
        // ====================================
        const testButton=document.getElementById("start");
        const testContainer = document.getElementById("test-container");
        const personalScore = document.getElementById("personal-score");
        const mouseButton = document.getElementById("souris");
        const spaceButton = document.getElementById("espace");
        let bestScore = localStorage.getItem('bestScore');
        let startTime;
        let timeout;
        let inputMode;
        let canClick = false;

        // =======================================
        // CHARGEMENT DU MODE D'ENTRÃ‰E SAUVEGARDÃ‰
        // =======================================

        if(localStorage.getItem("inputMode")){
          inputMode = localStorage.getItem("inputMode");
        }
        else{
          inputMode = "mouse";
        }

        //ajouter du style selon le mode d'entrÃ©e
        if(inputMode === "mouse"){
          mouseButton.classList.add("active-mode");
          spaceButton.classList.remove("active-mode");
        }
        else{
          spaceButton.classList.add("active-mode");
          mouseButton.classList.remove("active-mode");
        }

        //affichage du score sauvgardÃ© ainsi que le niveau acquis
        if(bestScore){
          if(bestScore>400)
          {
            personalScore.innerHTML = `
            <h1 style="color: #5a6c7d; padding-top: 2em;">${bestScore} ms -> DÃ©butant ğŸ¢</h1>
            `;
          }
          else if(bestScore >= 300 && bestScore < 400)
          {
            personalScore.innerHTML = `
            <h1 style="color: #5a6c7d; padding-top: 2em;">${bestScore} ms -> IntermÃ©diare ğŸ¯</h1>
            `;
          }
          else if(bestScore >= 200 && bestScore < 300)
          {
            personalScore.innerHTML = `
            <h1 style="color: #5a6c7d; padding-top: 2em;">${bestScore} ms -> AvancÃ© ğŸš€</h1>
            `;
          }
          else if(bestScore >= 150 && bestScore < 200)
          {
            personalScore.innerHTML = `
            <h1 style="color: #5a6c7d; padding-top: 2em;">${bestScore} ms -> Professionnel ğŸ†</h1>
            `;
          }
          else {
            personalScore.innerHTML = `
            <h1 style="color: #5a6c7d; padding-top: 2em;">${bestScore} ms -> Ã‰lite ğŸ‘‘</h1>
            `;
          }
        }

        //Lancement du jeu dans le mode souris
        testButton.addEventListener("click",startTest)

        //Lancement du jeu dans le mode clavier
        //code plus dÃ©velopÃ© que celui du mode souris car le clavier a beaucoup de buttons
        //donc il faut  qu'on filtre l'appui sur l'espace
        document.addEventListener("keydown",function(e){
          if(inputMode === "keyboard" && e.code ==="Space")
          {
            //pour Ã©chapper le fonctionnement normal de l'espace (dÃ©cendre dans la page web)
            e.preventDefault()
            if(testButton.style.display !== "none"){
              startTest();
            }
          }
        });

        function startTest(){
            canClick = false;
            document.querySelector(".instruction").style.display = "none";
            testContainer.style.background = "red";
            testContainer.innerHTML = "<h2>Attendez le VERT</h2>";
            testContainer.style.cursor = "pointer";
            

            //temps alÃ©atoire entre 1 et 5
            const randomTime = Math.random()*5000 + 1000;

            //Les Ã©vÃ©nements pour dÃ©tecter les clics trop tÃ´t
            //Rq trÃ¨s importante: DÃ©lai de 50ms pour Ã©viter que le clic sur le bouton "start" 
            // ne dÃ©clenche immÃ©diatement checkEarly() Ã  cause de la propagation d'Ã©vÃ©nement dans
            // Timeline RÃ‰ELLE quand vous cliquez sur #start :**

            // Temps 0ms : ğŸ‘† Clic sur <button id="start">
            //             â†“
            // Temps 0.1ms : JavaScript dÃ©tecte le clic sur #start
            //             â†“
            // Temps 0.2ms : startTest() s'exÃ©cute
            //             â†“
            // Temps 0.3ms : addEventListener("click", checkEarly) est ajoutÃ© Ã  #test-container
            //             â†“
            // Temps 0.4ms : startTest() se termine
            //             â†“
            //             âš ï¸ MAINTENANT LA PROPAGATION CONTINUE âš ï¸
            //             â†“
            // Temps 0.5ms : Le clic REMONTE de <button> vers <div id="test-container">
            //             â†“
            // Temps 0.6ms : #test-container reÃ§oit le clic
            //             â†“
            // Temps 0.7ms : #test-container voit qu'il a un addEventListener
            //             â†“
            // Temps 0.8ms : checkEarly() s'exÃ©cute âŒ (TROP TÃ”T dÃ©tectÃ©)

            if(inputMode === "mouse"){
              setTimeout(() => {
                testContainer.addEventListener("click", checkEarly);
            }, 50);

            //il n'y a pas le mÃªme probleme avec l'espace car c'est un click sur le button et non pas un appui sur l'espace 
            } else {
              document.addEventListener("keydown", checkEarlySpace);
            }

            //affichage du couleur verte et attendre pour le click
            timeout = setTimeout(function(){
                testContainer.removeEventListener("click", checkEarly);
                document.removeEventListener("keydown", checkEarlySpace);
                canClick = true;
                testContainer.style.backgroundColor = "#04b926";
                testContainer.innerHTML = "<h2>CLIQUEZ MAINTENANT!</h2>";
                startTime = Date.now();

                //ajouter l'Ã©vÃ©nement de clic/espace sur le container
                if(inputMode==="mouse")
                {
                  testContainer.addEventListener("click",afterReaction);
                }
                else{
                  document.addEventListener("keydown",spaceReaction);
                }
            },randomTime);
        };

        //le jeu s'est arrÃªtÃ©e aprÃ¨s le click (ou appui sur l'espace) trÃ¨s tÃ´t 
        function checkEarly(){
          if(!canClick){
            clearTimeout(timeout);
            testContainer.style.backgroundColor = "#ff4444";
            testContainer.innerHTML = `
              <h2>âŒ TROP TÃ”T !</h2>
              <p>Vous avez cliquÃ© avant que la boÃ®te ne devienne verte</p>
              <button id="retry" style="border-radius: 0.5em; background: linear-gradient(90deg, #c9f1ff, #8ed8f8); color: #003b5c; padding: 1em 2em; border: none; margin-top: 1em; font-size: 1em; cursor: pointer;">RÃ‰ESSAYER</button>
            `;
            testContainer.removeEventListener("click",checkEarly);
             document.getElementById("retry").addEventListener("click", function() {
                location.reload();
          });
        }
      }

        function checkEarlySpace(e){
          if(e.code === "Space" && !canClick){
            e.preventDefault();
            clearTimeout(timeout);
            testContainer.style.backgroundColor = "#ff4444";
            testContainer.innerHTML = `
              <h2>âŒ TROP TÃ”T !</h2>
              <p>Vous avez appuyÃ© sur Espace avant que la boÃ®te ne devienne verte</p>
              <button id="retry" style="border-radius: 0.5em; background: linear-gradient(90deg, #c9f1ff, #8ed8f8); color: #003b5c; padding: 1em 2em; border: none; margin-top: 1em; font-size: 1em; cursor: pointer;">RÃ‰ESSAYER</button>
            `;
            document.removeEventListener("keydown", checkEarlySpace);
            document.getElementById("retry").addEventListener("click", function() {
              location.reload();
            });
          }
        }

        //reaction de l'espace
        function spaceReaction(e){
          if(e.code === "Space"){
            e.preventDefault();
            document.removeEventListener('keydown', spaceReaction);
            afterReaction();
          }
        }

        //reaction
        function afterReaction(){
            canClick=true;
            const reactionTime = Date.now() - startTime;
            if(bestScore === null || parseInt(bestScore) > reactionTime){
              localStorage.setItem('bestScore',reactionTime);
              bestScore = reactionTime;

               personalScore.innerHTML = `
                    <h1 style="color: #04b962; padding-top: 1em;">ğŸ‰ ${reactionTime} ms</h1>
                    <p style="color: #04b962; font-weight: bold;">NOUVEAU RECORD PERSONNEL !</p>
                `;
            }
            else{
              personalScore.innerHTML = `
            <h1 style="color: #0077b6; padding-top: 2em;">${bestScore} ms</h1>
            `;
            }

            //Afficher le rÃ©sultat
            testContainer.style.backgroundColor = "#0077b6";
            testContainer.innerHTML = ``
             // VÃ©rifier le niveau selon le temps de rÃ©action
            if(reactionTime > 400)
            {
              testContainer.innerHTML=`<h2>â³ Votre temps: ${reactionTime} ms</h2>
            <h3>Vous pouvez faire mieux ! ğŸ¢</h3>
            <p>Pas le dÃ©part le plus rapide, mais ne vous inquiÃ©tez pas â€”
            les rÃ©flexes s'amÃ©liorent avec la pratique. Continuez Ã  vous entraÃ®ner et vous serez bientÃ´t un Ã©clair ! âš¡
            </p>
            <button id="retry" style=
            "border-radius: 0.5em;
            background: linear-gradient(90deg, #c9f1ff, #8ed8f8);
            color: #003b5c;
            padding: 1em 2em;
            border: none;
            margin-top: 1em;
            font-size: 1em;
            cursor: pointer;">
            RÃ‰ESSAYER
            </button>
              `;
            }
              else if(reactionTime >= 300 && reactionTime < 400) {
                // IntermÃ©diaire
                testContainer.innerHTML = `<h2>âš¡ Votre temps: ${reactionTime} ms</h2>
                <h3>Pas mal ! ğŸ¯</h3>
                <p>Vous Ãªtes au niveau intermÃ©diaire ! Vos rÃ©flexes sont corrects, 
                mais il y a encore de la marge pour progresser. Continuez comme Ã§a ! ğŸ’ª
                </p>
                <button id="retry" style="border-radius: 0.5em; background: linear-gradient(90deg, #c9f1ff, #8ed8f8); color: #003b5c; padding: 1em 2em; border: none; margin-top: 1em; font-size: 1em; cursor: pointer;">RÃ‰ESSAYER</button>`;
            }
            else if(reactionTime >= 200 && reactionTime < 300) {
                // AvancÃ©
                testContainer.innerHTML = `<h2>âš¡âš¡ Votre temps: ${reactionTime} ms</h2>
                <h3>Excellent ! ğŸš€</h3>
                <p>Vous Ãªtes au niveau avancÃ© ! Vos rÃ©flexes sont impressionnants. 
                Vous Ãªtes rapide et prÃ©cis. Encore un petit effort pour atteindre le niveau professionnel ! ğŸ”¥
                </p>
                <button id="retry" style="border-radius: 0.5em; background: linear-gradient(90deg, #c9f1ff, #8ed8f8); color: #003b5c; padding: 1em 2em; border: none; margin-top: 1em; font-size: 1em; cursor: pointer;">RÃ‰ESSAYER</button>`;
            }
            else if(reactionTime >= 150 && reactionTime < 200) {
                // Professionnel
                testContainer.innerHTML = `<h2>âš¡âš¡âš¡ Votre temps: ${reactionTime} ms</h2>
                <h3>Incroyable ! ğŸ†</h3>
                <p>Vous Ãªtes au niveau professionnel ! Vos rÃ©flexes sont d'une rapiditÃ© exceptionnelle. 
                Vous faites partie des meilleurs ! Pouvez-vous atteindre le niveau Ã©lite ? ğŸ‘‘
                </p>
                <button id="retry" style="border-radius: 0.5em; background: linear-gradient(90deg, #c9f1ff, #8ed8f8); color: #003b5c; padding: 1em 2em; border: none; margin-top: 1em; font-size: 1em; cursor: pointer;">RÃ‰ESSAYER</button>`;
            }
            else {
                // Ã‰lite (0-149ms)
                testContainer.innerHTML = `<h2>âš¡âš¡âš¡âš¡ Votre temps: ${reactionTime} ms</h2>
                <h3>LÃ‰GENDAIRE ! ğŸ‘‘</h3>
                <p>Vous Ãªtes au niveau Ã‰LITE ! Vos rÃ©flexes sont absolument extraordinaires ! 
                Vous faites partie de l'Ã©lite mondiale. FÃ©licitations, champion ! ğŸ‰ğŸ†
                </p>
                <button id="retry" style="border-radius: 0.5em; background: linear-gradient(90deg, #c9f1ff, #8ed8f8); color: #003b5c; padding: 1em 2em; border: none; margin-top: 1em; font-size: 1em; cursor: pointer;">RÃ‰ESSAYER</button>`;
            }
    
            testContainer.style.cursor = "default";
            testContainer.removeEventListener("click",afterReaction);
            // Ajouter l'Ã©vÃ©nement au bouton rÃ©essayer
            document.getElementById("retry").addEventListener("click", function() {
             location.reload();
            });
        }
        
        //Changer l'input mode et ajouter un style d'activation pour le button choisit.
        mouseButton.addEventListener("click",function(){
          inputMode = "mouse";
          localStorage.setItem("inputMode","mouse");
          mouseButton.classList.add("active-mode");
          spaceButton.classList.remove("active-mode");
        })

         spaceButton.addEventListener("click",function(){
          inputMode = "keyboard";
          localStorage.setItem("inputMode","keyboard");
          spaceButton.classList.add("active-mode");
          mouseButton.classList.remove("active-mode");
        })

    </script>
  </body>
</html>